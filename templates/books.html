{% extends "layout.html" %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col-md-6">
        <h2>Inventory</h2>
    </div>
    <div class="col-md-6 text-end">
        <a href="/issue" class="btn btn-primary">+ Issue Book</a>
    </div>
</div>

<div class="card p-3 mb-4">
    <div class="row g-3">
        <div class="col-md-5">
            <input type="text" id="searchInput" class="form-control" placeholder="ðŸ” Search Title, Author, ID...">
        </div>
        <div class="col-md-3">
            <select id="departmentFilter" class="form-select">
                <option value="">All Departments</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Mechanical">Mechanical</option>
                <option value="Civil">Civil</option>
                <option value="Electronics">Electronics</option>
                <option value="MBA">MBA</option>
            </select>
        </div>
        <div class="col-md-4">
            <select id="statusFilter" class="form-select">
                <option value="">All Statuses</option>
                <option value="Available">ðŸŸ¢ Available</option>
                <option value="Issued">ðŸ”´ Issued</option>
            </select>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <table class="table table-hover" id="booksTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Department</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr class="book-row" data-dept="{{ book.Department }}" data-status="{{ book.Status }}">
                    <td><code>{{ book.BookID }}</code></td>
                    <td class="book-title">{{ book.Title }}</td>
                    <td class="book-author">{{ book.Author }}</td>
                    <td><span class="badge bg-light text-dark border">{{ book.Department }}</span></td>
                    <td>
                        {% if book.Status == 'Issued' %}
                        <span class="badge bg-warning text-dark">Issued</span>
                        {% else %}
                        <span class="badge bg-success">Available</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const departmentFilter = document.getElementById('departmentFilter');
    const statusFilter = document.getElementById('statusFilter');
    const rows = document.querySelectorAll('.book-row');

    function filterBooks() {
        const term = searchInput.value.toLowerCase();
        const dept = departmentFilter.value;
        const status = statusFilter.value;

        rows.forEach(row => {
            const title = row.querySelector('.book-title').textContent.toLowerCase();
            const author = row.querySelector('.book-author').textContent.toLowerCase();
            const id = row.cells[0].textContent.toLowerCase();
            const rowDept = row.dataset.dept;
            const rowStatus = row.dataset.status;

            const matchesSearch = title.includes(term) || author.includes(term) || id.includes(term);
            const matchesDept = dept === "" || rowDept === dept;
            const matchesStatus = status === "" || rowStatus === status;

            if (matchesSearch && matchesDept && matchesStatus) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    searchInput.addEventListener('input', filterBooks);
    departmentFilter.addEventListener('change', filterBooks);
    statusFilter.addEventListener('change', filterBooks);
</script>
{% endblock %}